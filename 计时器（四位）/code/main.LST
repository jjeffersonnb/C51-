C51 COMPILER V9.00   MAIN                                                                  02/07/2020 21:53:02 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\APPS\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          #define uchar unsigned char
   3          #define uint unsigned int
   4          uchar code table0[]=              //共阳码
   5               { 0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,
   6                     0x80,0x90,0x88,0x83,0xc6,0xa1,0x86,0x8e};
   7          uchar code table2[]={0x01,0x02,0x04,0x08};      //位选码
   8          uint count;
   9          sbit K1=P1^0;                              //十位加1按钮
  10          sbit K2=P1^3;                              //个位加1按钮
  11          sbit K3=P1^6;                              //计时开始按钮
  12          sbit BUZZER=P3^1;                          //蜂鸣器
  13          
  14          void delayms(uint x)
  15          {
  16   1              uchar t;
  17   1              while(x--)
  18   1                      for(t=0;t<120;t++);
  19   1      }
  20          
  21          void display(uint temp)                 //显示子程序
  22          {
  23   1              uchar i,buf[4];
  24   1              buf[0]=temp/1000;                       //分离4位数值的千、百、十、个位
  25   1              buf[1]=temp%1000/100;
  26   1              buf[2]=temp%100/10;
  27   1              buf[3]=temp%10;
  28   1              for(i=0;i<4;i++)                        //4位轮流显示
  29   1              {
  30   2                      P2=table2[i];                   //送位选信号
  31   2                      P0=table0[buf[i]];              //送段选信号
  32   2                      delayms(5);                             //延时一段时间
  33   2                      P1=0xff;                                //消隐
  34   2              }
  35   1      }
  36          
  37          
  38          void KeyScan()                                          //按键扫描函数
  39          {                                                                       
  40   1              if(K1==0)                                               //十位加1按键
  41   1              {                                                               
  42   2                      while(K1==0);                           //等待用户释放按键
  43   2                      TR0=0; BUZZER=1;                        //关闭定时器与蜂鸣器
  44   2                      if(count<=9999)count+=10;
  45   2              }
  46   1              if(K2==0)                                               //个位加1按键
  47   1              {
  48   2                      while(K2==0);
  49   2                      TR0=0; BUZZER=1;
  50   2                      if(count<=9999)count+=1;
  51   2              }
  52   1              if(K3==0)                                               //开始按键
  53   1              {
  54   2                      while(K3==0);
  55   2                      if(count==0)
C51 COMPILER V9.00   MAIN                                                                  02/07/2020 21:53:02 PAGE 2   

  56   2                      {
  57   3                              TR0=0; BUZZER=1;
  58   3                      }
  59   2                      else
  60   2                              TR0=1;                                  //计时开始 
  61   2              }
  62   1      }
  63          
  64          void main()                                                //主函数
  65          {
  66   1              count = 0;                                         //默认初值为0
  67   1              BUZZER = 1;                                        //蜂鸣器默认不响
  68   1              TMOD=0x01;                                         //设置定时器T0工作方式为模式0
  69   1              TH0=(65536-50000)/256;             //定时50ms
  70   1              TL0=(65536-50000)%256;             //开定时器T0中断
  71   1              EA=1; ET0=1;
  72   1              while(1)
  73   1              {
  74   2                      display(count);
  75   2                      KeyScan();
  76   2              }
  77   1      }
  78          void timer0() interrupt 1                       //定时器T0中断服务函数
  79          {                                                                       
  80   1              static uchar temp=0;                    //内部静态变量，用于计数
  81   1              TH0=(65536-50000)/256;                  //定时50ms
  82   1              TL0=(65536-50000)%256;
  83   1              if(++temp==20)                                  //20*50ms=1s，定时1秒后
  84   1              {
  85   2                      if(count>0)
  86   2                      {
  87   3                              count--;                                //count减1
  88   3                              temp=0;
  89   3                      }
  90   2                      else
  91   2                              BUZZER=0;                          //打开蜂鸣器                 
  92   2              }
  93   1      }
  94          
  95          
  96                  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    296    ----
   CONSTANT SIZE    =     20    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
