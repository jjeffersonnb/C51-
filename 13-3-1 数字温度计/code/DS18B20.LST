C51 COMPILER V9.00   DS18B20                                                               01/17/2019 10:01:07 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN DS18B20.OBJ
COMPILER INVOKED BY: C:\APPS\Keil\C51\BIN\C51.EXE DS18B20.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /***************   DS18B20.C 温度传感器（-55～125 C）   ******************/
   2          #include <reg52.h>
   3          #include <intrins.h>
   4          #define uint unsigned int
   5          #define uchar unsigned char
   6          
   7          sbit DQ = P3^3;
   8          
   9          void Delay(uint x)
  10          {       while(--x);  }
  11          
  12          uchar Init_DS18B20()  //成功返回0，失败返回1
  13          {
  14   1              uchar status;
  15   1              DQ = 1; Delay(8);
  16   1              DQ = 0; Delay(90);
  17   1              DQ = 1; Delay(8);
  18   1              status = DQ; Delay(100);
  19   1              DQ = 1;
  20   1              return status;
  21   1      }
  22          
  23          uchar ReadOneByte()     //读一个字节
  24          {
  25   1              uchar i,dat=0;
  26   1              DQ = 1; _nop_();
  27   1              for(i=0;i<8;i++)
  28   1              {
  29   2                      DQ = 0;
  30   2                      dat >>= 1;
  31   2                      DQ = 1; _nop_(); _nop_();
  32   2                      if(DQ)
  33   2                              dat |= 0X80;
  34   2                      Delay(30);
  35   2                      DQ = 1;
  36   2              }
  37   1              return dat;
  38   1      }
  39          
  40          void WriteOneByte(uchar dat)  //写一个字节
  41          {
  42   1              uchar i;
  43   1              for(i=0;i<8;i++)
  44   1              {
  45   2                      DQ = 0;
  46   2                      DQ = dat & 0x01;
  47   2                      Delay(5);
  48   2                      DQ = 1;
  49   2                      dat >>= 1;
  50   2              }
  51   1      }
  52          
  53          int Get_Temperature()    //读取温度
  54          {
  55   1              int t;
C51 COMPILER V9.00   DS18B20                                                               01/17/2019 10:01:07 PAGE 2   

  56   1              float tt;
  57   1              uchar a,b,fh;//fh表示负号
  58   1              if(Init_DS18B20()==1)
  59   1                      t = 2000;  //初始化失败，温度应小于125
  60   1              else
  61   1              {
  62   2                      WriteOneByte(0xcc);//跳过读序列号，可加速
  63   2                      WriteOneByte(0x44);     //启动温度转换
  64   2                      Delay(100);
  65   2                      Init_DS18B20();
  66   2                      WriteOneByte(0xcc);//跳过读序列号，可加速
  67   2                      WriteOneByte(0xbe);     //读取温度寄存器（共9个，前两个为温度）
  68   2                      a = ReadOneByte(); //低位
  69   2                      b = ReadOneByte(); //高位               
  70   2                      fh = b & 0x80;
  71   2                      if(fh!=0) //fu的最高位为1，表示负数
  72   2                      {
  73   3                              b = ~b;
  74   3                              a = ~a;
  75   3                              tt = ((b*256)+a+1)*0.0625;
  76   3                              t=(int)(tt*10)*(-1);
  77   3                      }
  78   2                      else
  79   2                      {
  80   3                              tt =((b*256)+a)*0.0625;
  81   3                              t=(int)(tt*10);
  82   3                      }                               
  83   2              }
  84   1              return t;
  85   1      }
  86          
  87                                                                          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    312    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
