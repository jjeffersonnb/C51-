C51 COMPILER V9.00   DS18B20                                                               02/02/2021 11:47:15 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN DS18B20.OBJ
COMPILER INVOKED BY: C:\APPS\Keil\C51\BIN\C51.EXE DS18B20.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /***************   DS18B20.C 温度传感器（-55～125 C）   ******************/
   2          #include <reg52.h>
   3          #include <intrins.h>
   4          #define uint unsigned int
   5          #define uchar unsigned char
   6          
   7          sbit DQ = P2^3;
   8          
   9          void Delay(uint x)
  10          {       while(--x);  }
  11          
  12          uchar Init_DS18B20()  //成功返回0，失败返回1
  13          {
  14   1              uchar status;
  15   1              DQ = 1; Delay(8);
  16   1              DQ = 0; Delay(90);
  17   1              DQ = 1; Delay(8);
  18   1              status = DQ; Delay(100);
  19   1              DQ = 1;
  20   1              return status;
  21   1      }
  22          
  23          uchar ReadOneByte()     //读一个字节
  24          {
  25   1              uchar i,dat=0;
  26   1              DQ = 1; _nop_();
  27   1              for(i=0;i<8;i++)
  28   1              {
  29   2                      DQ = 0;
  30   2                      dat >>= 1;
  31   2                      DQ = 1; _nop_(); _nop_();
  32   2                      if(DQ)
  33   2                              dat |= 0X80;
  34   2                      Delay(30);
  35   2                      DQ = 1;
  36   2              }
  37   1              return dat;
  38   1      }
  39          
  40          void WriteOneByte(uchar dat)  //写一个字节
  41          {
  42   1              uchar i;
  43   1              for(i=0;i<8;i++)
  44   1              {
  45   2                      DQ = 0;
  46   2                      DQ = dat & 0x01;
  47   2                      Delay(5);
  48   2                      DQ = 1;
  49   2                      dat >>= 1;
  50   2              }
  51   1      }
  52          
  53          int Get_Temperature()    //读取温度
  54          {
  55   1              int t;
C51 COMPILER V9.00   DS18B20                                                               02/02/2021 11:47:15 PAGE 2   

  56   1              float tt;
  57   1              uchar a,b,fh;//fh表示负号
  58   1              Init_DS18B20();
  59   1              WriteOneByte(0xcc);//跳过读序列号，可加速
  60   1              WriteOneByte(0x44);     //启动温度转换
  61   1              Init_DS18B20();
  62   1              WriteOneByte(0xcc);//跳过读序列号，可加速
  63   1              WriteOneByte(0xbe);     //读取温度寄存器（共9个，前两个为温度）
  64   1              a = ReadOneByte(); //低位
  65   1              b = ReadOneByte(); //高位               
  66   1              Delay(100);
  67   1              fh = b & 0x80;
  68   1              if(fh!=0) //fu的最高位为1，表示负数
  69   1              {
  70   2                      b = ~b;
  71   2                      a = ~a;
  72   2                      tt = ((b*256)+a+1)*0.0625;
  73   2                      t=(int)(tt*10)*(-1);
  74   2              }
  75   1              else
  76   1              {
  77   2                      tt =((b*256)+a)*0.0625;
  78   2                      t=(int)(tt*10);
  79   2              }                               
  80   1      
  81   1              return t;
  82   1      }
  83          
  84                                                                          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    303    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
